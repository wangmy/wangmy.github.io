<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='å‰è¨€ è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒç›®çš„æ˜¯è·Ÿç€è‹¹æœæºç ï¼Œæ·±åº¦å­¦ä¹ å¹¶ç†è§£iOS APPå¯åŠ¨è¿‡ç¨‹ã€‚
åŸºç¡€æ¦‚å¿µ å†·å¯åŠ¨ æ³¨æ„ï¼šåœ¨æ—¥å¸¸å¼€å‘æˆ–æµ‹è¯•çš„æ—¶å€™ä¸ºäº†ï¼Œè§¦å‘å†·å¯åŠ¨çŠ¶æ€ï¼Œä¼šæ‰‹åŠ¨kill appï¼Œç„¶åç‚¹å‡»å¯åŠ¨ã€‚è¿™ç§æƒ…å†µä¸‹çš„å†·å¯åŠ¨å¯èƒ½ä¼šä¸ä¸Šè¿°å†·å¯åŠ¨è¿‡ç¨‹çš„æ­¥éª¤ç¨å¾®å°‘äº›ï¼Œå¯ä»¥é…åˆInstrumentè°ƒè¯•éªŒè¯ï¼ˆè¿™ä¸ªåœ¨æ–‡ç« ç»“å°¾ä¼šåšä»‹ç»ï¼‰ã€‚å› æ­¤é€šå¸¸å¦‚æœè¦æ¨¡æ‹Ÿæ›´çœŸå®å…¨é¢çš„å†·å¯åŠ¨ï¼Œåœ¨kill appåï¼Œå†æ‰“å¼€/å¹¶ç¨å¾®ä½¿ç”¨å‡ ä¸ªå…¶ä»–appã€‚
é€šå¸¸è¯´çš„å¯åŠ¨ï¼Œä¹Ÿæ˜¯æŒ‡çš„å†·å¯åŠ¨ï¼›å¯åŠ¨ä¼˜åŒ–å¤§éƒ¨åˆ†ä¹Ÿæ˜¯åšå†·å¯åŠ¨éƒ¨åˆ†çš„æ€§èƒ½ä¼˜åŒ– æš‚ä¸”å¯ä»¥æŠŠå†·å¯åŠ¨åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š
T1: mainä¹‹å‰ï¼ŒåŠ è½½Appå¯æ‰§è¡Œæ–‡ä»¶åˆ°å†…å­˜ï¼Œç„¶åæ‰§è¡Œä¸€ç³»åˆ—çš„åŠ è½½&amp;amp;é“¾æ¥ç­‰å·¥ä½œï¼Œæœ€åæ‰§è¡Œåˆ°main()å‡½æ•° T2: mainä¹‹åï¼ŒdidFinishLaunchingä¹‹å‰ï¼Œè¿™éƒ¨åˆ†å¼€å‘æ˜¯å¯ä»¥ç›‘å¬åˆ°çš„ T3: didFinishLaunchingä¹‹åï¼Œå¯åŠ¨é¡µé¢å‡ºç°ä¹‹å‰ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›‘å¬çš„ çƒ­å¯åŠ¨ çƒ­å¯åŠ¨çš„é˜¶æ®µå’ŒçŠ¶æ€éƒ½æ˜¯å¯ç›‘å¬çš„ï¼Œä¸åšè¿‡å¤šä»‹ç»ã€‚
åº”ç”¨ç¨‹åºçš„çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 å¯åŠ¨ç¨‹åº willFinishLaunchingWithOptions didFinishLaunchingWithOptions applicationDidBecomeActive æŒ‰ä¸‹homeé”® applicationWillResignActive applicationDidEnterBackground åŒå‡»homeé”®ï¼Œå†æ‰“å¼€ç¨‹åº applicationWillEnterForeground applicationDidBecomeActive ç®€å•ç†è§£ç¼–è¯‘è¿‡ç¨‹ åº”ç”¨ç¨‹åºåŠ è½½è¿‡ç¨‹ä¸­ä¼šä¾èµ–å¾ˆå¤šåº•å±‚åº“ï¼Œè¿™äº›åº•å±‚åº“å…¶å®å°±æ˜¯å¯æ‰§è¡Œçš„ä»£ç çš„äºŒè¿›åˆ¶ï¼Œè¢«æ“ä½œç³»ç»Ÿå†™å…¥åˆ°å†…å­˜ã€‚ é™æ€åº“ æ¯”å¦‚ï¼š .a, .lib åœ¨é“¾æ¥é˜¶æ®µï¼Œä¼šå°†æ±‡ç¼–ç”Ÿæˆçš„ç›®æ ‡ä¸å¼•ç”¨çš„åº“ä¸€èµ·é“¾æ¥æ‰“åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ åŠ¨æ€åº“ æ¯”å¦‚ï¼š frameworkï¼Œ.so, .dllï¼ŒUIKIT.frameworkï¼Œ libsystemï¼Œ libdispatchï¼Œlibobjc åŠ¨æ€åº“æ ¹æ®éœ€è¦ç¼–è¯‘ï¼ŒåŠ¨æ€åŠ è½½ï¼Œåœ¨è¿è¡Œæ—¶æ‰è¢«è½½å…¥ï¼ŒèŠ‚çº¦èµ„æºï¼Œå‡å°ä½“ç§¯ã€‚ å®šä½æ ¸å¿ƒæºç å…¥å£ mainå‡½æ•°ï¼Œæ–­ç‚¹å †æ ˆï¼ˆDebug/Debug Workflow/Always Show Disassembly å¼€å¯æ±‡ç¼–Debugï¼‰å¯ä»¥çœ‹åˆ°æ˜¯æœ€æ—©æ˜¯ï¼šdyldçš„start: åœ¨ç‰¹æ®Šæ–¹æ³• &#43; loadï¼ˆæˆ–&#43; (void)initializeï¼‰æ–¹æ³•ï¼Œåœ¨æ­¤æ–­ç‚¹ åˆæ¢ç»“è®ºï¼š _dyld_start -&amp;gt; &#43;load -&amp;gt; main -&amp;gt; &#43;initialize'>
<title>iOSåº”ç”¨ç¨‹åºåŠ è½½</title>

<link rel='canonical' href='/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/'>

<link rel="stylesheet" href="/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css"><meta property='og:title' content='iOSåº”ç”¨ç¨‹åºåŠ è½½'>
<meta property='og:description' content='å‰è¨€ è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒç›®çš„æ˜¯è·Ÿç€è‹¹æœæºç ï¼Œæ·±åº¦å­¦ä¹ å¹¶ç†è§£iOS APPå¯åŠ¨è¿‡ç¨‹ã€‚
åŸºç¡€æ¦‚å¿µ å†·å¯åŠ¨ æ³¨æ„ï¼šåœ¨æ—¥å¸¸å¼€å‘æˆ–æµ‹è¯•çš„æ—¶å€™ä¸ºäº†ï¼Œè§¦å‘å†·å¯åŠ¨çŠ¶æ€ï¼Œä¼šæ‰‹åŠ¨kill appï¼Œç„¶åç‚¹å‡»å¯åŠ¨ã€‚è¿™ç§æƒ…å†µä¸‹çš„å†·å¯åŠ¨å¯èƒ½ä¼šä¸ä¸Šè¿°å†·å¯åŠ¨è¿‡ç¨‹çš„æ­¥éª¤ç¨å¾®å°‘äº›ï¼Œå¯ä»¥é…åˆInstrumentè°ƒè¯•éªŒè¯ï¼ˆè¿™ä¸ªåœ¨æ–‡ç« ç»“å°¾ä¼šåšä»‹ç»ï¼‰ã€‚å› æ­¤é€šå¸¸å¦‚æœè¦æ¨¡æ‹Ÿæ›´çœŸå®å…¨é¢çš„å†·å¯åŠ¨ï¼Œåœ¨kill appåï¼Œå†æ‰“å¼€/å¹¶ç¨å¾®ä½¿ç”¨å‡ ä¸ªå…¶ä»–appã€‚
é€šå¸¸è¯´çš„å¯åŠ¨ï¼Œä¹Ÿæ˜¯æŒ‡çš„å†·å¯åŠ¨ï¼›å¯åŠ¨ä¼˜åŒ–å¤§éƒ¨åˆ†ä¹Ÿæ˜¯åšå†·å¯åŠ¨éƒ¨åˆ†çš„æ€§èƒ½ä¼˜åŒ– æš‚ä¸”å¯ä»¥æŠŠå†·å¯åŠ¨åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š
T1: mainä¹‹å‰ï¼ŒåŠ è½½Appå¯æ‰§è¡Œæ–‡ä»¶åˆ°å†…å­˜ï¼Œç„¶åæ‰§è¡Œä¸€ç³»åˆ—çš„åŠ è½½&amp;amp;é“¾æ¥ç­‰å·¥ä½œï¼Œæœ€åæ‰§è¡Œåˆ°main()å‡½æ•° T2: mainä¹‹åï¼ŒdidFinishLaunchingä¹‹å‰ï¼Œè¿™éƒ¨åˆ†å¼€å‘æ˜¯å¯ä»¥ç›‘å¬åˆ°çš„ T3: didFinishLaunchingä¹‹åï¼Œå¯åŠ¨é¡µé¢å‡ºç°ä¹‹å‰ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›‘å¬çš„ çƒ­å¯åŠ¨ çƒ­å¯åŠ¨çš„é˜¶æ®µå’ŒçŠ¶æ€éƒ½æ˜¯å¯ç›‘å¬çš„ï¼Œä¸åšè¿‡å¤šä»‹ç»ã€‚
åº”ç”¨ç¨‹åºçš„çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 å¯åŠ¨ç¨‹åº willFinishLaunchingWithOptions didFinishLaunchingWithOptions applicationDidBecomeActive æŒ‰ä¸‹homeé”® applicationWillResignActive applicationDidEnterBackground åŒå‡»homeé”®ï¼Œå†æ‰“å¼€ç¨‹åº applicationWillEnterForeground applicationDidBecomeActive ç®€å•ç†è§£ç¼–è¯‘è¿‡ç¨‹ åº”ç”¨ç¨‹åºåŠ è½½è¿‡ç¨‹ä¸­ä¼šä¾èµ–å¾ˆå¤šåº•å±‚åº“ï¼Œè¿™äº›åº•å±‚åº“å…¶å®å°±æ˜¯å¯æ‰§è¡Œçš„ä»£ç çš„äºŒè¿›åˆ¶ï¼Œè¢«æ“ä½œç³»ç»Ÿå†™å…¥åˆ°å†…å­˜ã€‚ é™æ€åº“ æ¯”å¦‚ï¼š .a, .lib åœ¨é“¾æ¥é˜¶æ®µï¼Œä¼šå°†æ±‡ç¼–ç”Ÿæˆçš„ç›®æ ‡ä¸å¼•ç”¨çš„åº“ä¸€èµ·é“¾æ¥æ‰“åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ åŠ¨æ€åº“ æ¯”å¦‚ï¼š frameworkï¼Œ.so, .dllï¼ŒUIKIT.frameworkï¼Œ libsystemï¼Œ libdispatchï¼Œlibobjc åŠ¨æ€åº“æ ¹æ®éœ€è¦ç¼–è¯‘ï¼ŒåŠ¨æ€åŠ è½½ï¼Œåœ¨è¿è¡Œæ—¶æ‰è¢«è½½å…¥ï¼ŒèŠ‚çº¦èµ„æºï¼Œå‡å°ä½“ç§¯ã€‚ å®šä½æ ¸å¿ƒæºç å…¥å£ mainå‡½æ•°ï¼Œæ–­ç‚¹å †æ ˆï¼ˆDebug/Debug Workflow/Always Show Disassembly å¼€å¯æ±‡ç¼–Debugï¼‰å¯ä»¥çœ‹åˆ°æ˜¯æœ€æ—©æ˜¯ï¼šdyldçš„start: åœ¨ç‰¹æ®Šæ–¹æ³• &#43; loadï¼ˆæˆ–&#43; (void)initializeï¼‰æ–¹æ³•ï¼Œåœ¨æ­¤æ–­ç‚¹ åˆæ¢ç»“è®ºï¼š _dyld_start -&amp;gt; &#43;load -&amp;gt; main -&amp;gt; &#43;initialize'>
<meta property='og:url' content='/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/'>
<meta property='og:site_name' content='YoyoWong'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2022-03-25T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2022-03-25T00:00:00&#43;00:00'/><meta property='og:image' content='/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805489933.jpg' />
<meta name="twitter:title" content="iOSåº”ç”¨ç¨‹åºåŠ è½½">
<meta name="twitter:description" content="å‰è¨€ è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒç›®çš„æ˜¯è·Ÿç€è‹¹æœæºç ï¼Œæ·±åº¦å­¦ä¹ å¹¶ç†è§£iOS APPå¯åŠ¨è¿‡ç¨‹ã€‚
åŸºç¡€æ¦‚å¿µ å†·å¯åŠ¨ æ³¨æ„ï¼šåœ¨æ—¥å¸¸å¼€å‘æˆ–æµ‹è¯•çš„æ—¶å€™ä¸ºäº†ï¼Œè§¦å‘å†·å¯åŠ¨çŠ¶æ€ï¼Œä¼šæ‰‹åŠ¨kill appï¼Œç„¶åç‚¹å‡»å¯åŠ¨ã€‚è¿™ç§æƒ…å†µä¸‹çš„å†·å¯åŠ¨å¯èƒ½ä¼šä¸ä¸Šè¿°å†·å¯åŠ¨è¿‡ç¨‹çš„æ­¥éª¤ç¨å¾®å°‘äº›ï¼Œå¯ä»¥é…åˆInstrumentè°ƒè¯•éªŒè¯ï¼ˆè¿™ä¸ªåœ¨æ–‡ç« ç»“å°¾ä¼šåšä»‹ç»ï¼‰ã€‚å› æ­¤é€šå¸¸å¦‚æœè¦æ¨¡æ‹Ÿæ›´çœŸå®å…¨é¢çš„å†·å¯åŠ¨ï¼Œåœ¨kill appåï¼Œå†æ‰“å¼€/å¹¶ç¨å¾®ä½¿ç”¨å‡ ä¸ªå…¶ä»–appã€‚
é€šå¸¸è¯´çš„å¯åŠ¨ï¼Œä¹Ÿæ˜¯æŒ‡çš„å†·å¯åŠ¨ï¼›å¯åŠ¨ä¼˜åŒ–å¤§éƒ¨åˆ†ä¹Ÿæ˜¯åšå†·å¯åŠ¨éƒ¨åˆ†çš„æ€§èƒ½ä¼˜åŒ– æš‚ä¸”å¯ä»¥æŠŠå†·å¯åŠ¨åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š
T1: mainä¹‹å‰ï¼ŒåŠ è½½Appå¯æ‰§è¡Œæ–‡ä»¶åˆ°å†…å­˜ï¼Œç„¶åæ‰§è¡Œä¸€ç³»åˆ—çš„åŠ è½½&amp;amp;é“¾æ¥ç­‰å·¥ä½œï¼Œæœ€åæ‰§è¡Œåˆ°main()å‡½æ•° T2: mainä¹‹åï¼ŒdidFinishLaunchingä¹‹å‰ï¼Œè¿™éƒ¨åˆ†å¼€å‘æ˜¯å¯ä»¥ç›‘å¬åˆ°çš„ T3: didFinishLaunchingä¹‹åï¼Œå¯åŠ¨é¡µé¢å‡ºç°ä¹‹å‰ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›‘å¬çš„ çƒ­å¯åŠ¨ çƒ­å¯åŠ¨çš„é˜¶æ®µå’ŒçŠ¶æ€éƒ½æ˜¯å¯ç›‘å¬çš„ï¼Œä¸åšè¿‡å¤šä»‹ç»ã€‚
åº”ç”¨ç¨‹åºçš„çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 å¯åŠ¨ç¨‹åº willFinishLaunchingWithOptions didFinishLaunchingWithOptions applicationDidBecomeActive æŒ‰ä¸‹homeé”® applicationWillResignActive applicationDidEnterBackground åŒå‡»homeé”®ï¼Œå†æ‰“å¼€ç¨‹åº applicationWillEnterForeground applicationDidBecomeActive ç®€å•ç†è§£ç¼–è¯‘è¿‡ç¨‹ åº”ç”¨ç¨‹åºåŠ è½½è¿‡ç¨‹ä¸­ä¼šä¾èµ–å¾ˆå¤šåº•å±‚åº“ï¼Œè¿™äº›åº•å±‚åº“å…¶å®å°±æ˜¯å¯æ‰§è¡Œçš„ä»£ç çš„äºŒè¿›åˆ¶ï¼Œè¢«æ“ä½œç³»ç»Ÿå†™å…¥åˆ°å†…å­˜ã€‚ é™æ€åº“ æ¯”å¦‚ï¼š .a, .lib åœ¨é“¾æ¥é˜¶æ®µï¼Œä¼šå°†æ±‡ç¼–ç”Ÿæˆçš„ç›®æ ‡ä¸å¼•ç”¨çš„åº“ä¸€èµ·é“¾æ¥æ‰“åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ åŠ¨æ€åº“ æ¯”å¦‚ï¼š frameworkï¼Œ.so, .dllï¼ŒUIKIT.frameworkï¼Œ libsystemï¼Œ libdispatchï¼Œlibobjc åŠ¨æ€åº“æ ¹æ®éœ€è¦ç¼–è¯‘ï¼ŒåŠ¨æ€åŠ è½½ï¼Œåœ¨è¿è¡Œæ—¶æ‰è¢«è½½å…¥ï¼ŒèŠ‚çº¦èµ„æºï¼Œå‡å°ä½“ç§¯ã€‚ å®šä½æ ¸å¿ƒæºç å…¥å£ mainå‡½æ•°ï¼Œæ–­ç‚¹å †æ ˆï¼ˆDebug/Debug Workflow/Always Show Disassembly å¼€å¯æ±‡ç¼–Debugï¼‰å¯ä»¥çœ‹åˆ°æ˜¯æœ€æ—©æ˜¯ï¼šdyldçš„start: åœ¨ç‰¹æ®Šæ–¹æ³• &#43; loadï¼ˆæˆ–&#43; (void)initializeï¼‰æ–¹æ³•ï¼Œåœ¨æ­¤æ–­ç‚¹ åˆæ¢ç»“è®ºï¼š _dyld_start -&amp;gt; &#43;load -&amp;gt; main -&amp;gt; &#43;initialize"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805489933.jpg' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu8ad42cd0bb16d295ddead16cde881b2f_58443_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸŒ»</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">YoyoWong</a></h1>
            <h2 class="site-description">Welcome ğŸ‘ğŸ‘ğŸ‘.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/wangmy'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>é“¾æ¥</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#å‰è¨€">å‰è¨€</a></li>
    <li><a href="#åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</a>
      <ol>
        <li><a href="#å†·å¯åŠ¨">å†·å¯åŠ¨</a></li>
        <li><a href="#çƒ­å¯åŠ¨">çƒ­å¯åŠ¨</a></li>
        <li><a href="#åº”ç”¨ç¨‹åºçš„çŠ¶æ€">åº”ç”¨ç¨‹åºçš„çŠ¶æ€</a></li>
      </ol>
    </li>
    <li><a href="#ç®€å•ç†è§£ç¼–è¯‘è¿‡ç¨‹">ç®€å•ç†è§£ç¼–è¯‘è¿‡ç¨‹</a>
      <ol>
        <li><a href="#é™æ€åº“">é™æ€åº“</a></li>
        <li><a href="#åŠ¨æ€åº“">åŠ¨æ€åº“</a></li>
      </ol>
    </li>
    <li><a href="#å®šä½æ ¸å¿ƒæºç å…¥å£">å®šä½æ ¸å¿ƒæºç å…¥å£</a>
      <ol>
        <li><a href="#åˆæ¢ç»“è®º">åˆæ¢ç»“è®ºï¼š</a></li>
        <li><a href="#__dyld_start">__dyld_start</a></li>
        <li><a href="#å…¥å£å‡½æ•°-uintptr_t-start">å…¥å£å‡½æ•° uintptr_t start(â€¦)</a></li>
        <li><a href="#æ ¸å¿ƒå‡½æ•°-dyld_main">æ ¸å¿ƒå‡½æ•° dyld::_main</a></li>
      </ol>
    </li>
    <li><a href="#dyldæ ¸å¿ƒæºç æµç¨‹">dyldæ ¸å¿ƒæºç æµç¨‹</a>
      <ol>
        <li><a href="#reloadallimages">reloadAllImages</a>
          <ol>
            <li><a href="#å®ä¾‹åŒ–ä¸»ç¨‹åº">å®ä¾‹åŒ–ä¸»ç¨‹åº</a></li>
            <li><a href="#åŠ è½½ä»»ä½•æ’å…¥åŠ¨æ€åº“">åŠ è½½ä»»ä½•æ’å…¥åŠ¨æ€åº“</a></li>
            <li><a href="#é“¾æ¥åº“">é“¾æ¥åº“</a></li>
          </ol>
        </li>
        <li><a href="#è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–ç¨‹åº---run-all-initializers">è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–ç¨‹åº - run all initializers</a>
          <ol>
            <li><a href="#runinitializers">runInitializers</a></li>
          </ol>
        </li>
        <li><a href="#å›è°ƒç›‘å¬">å›è°ƒç›‘å¬</a>
          <ol>
            <li><a href="#å¯ä»¥çŒœæµ‹æµç¨‹">å¯ä»¥çŒœæµ‹æµç¨‹</a></li>
            <li><a href="#æå‡ºç–‘é—®">æå‡ºç–‘é—®</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#libobjc-å¯åŠ¨æ ¸å¿ƒæºç åˆ†æ">libobjc å¯åŠ¨æ ¸å¿ƒæºç åˆ†æ</a>
      <ol>
        <li><a href="#æ‰¾åˆ°-_dyld_objc_notify_register-å…¥å£">æ‰¾åˆ° _dyld_objc_notify_register å…¥å£</a></li>
        <li><a href="#build--run-libobjc">build &amp; run libobjc</a></li>
        <li><a href="#ç¡®è®¤åŸºç¡€æµç¨‹">ç¡®è®¤åŸºç¡€æµç¨‹</a></li>
      </ol>
    </li>
    <li><a href="#éªŒè¯æµç¨‹---é…åˆlibsytemæºç libdispatchæºç ">éªŒè¯æµç¨‹ - é…åˆlibSytemæºç ï¼Œlibdispatchæºç </a>
      <ol>
        <li><a href="#dyld-åˆå§‹åŒ–å¿…é¡»ç¡®ä¿å…ˆå®Œæˆ-libsystem-åˆå§‹åŒ–">dyld åˆå§‹åŒ–å¿…é¡»ç¡®ä¿å…ˆå®Œæˆ libSystem åˆå§‹åŒ–</a></li>
        <li><a href="#libsytem-initializer">libSytem initializer</a></li>
        <li><a href="#libdispatch_init">libdispatch_init</a></li>
      </ol>
    </li>
    <li><a href="#å¯åŠ¨å®Œæ•´æµç¨‹">å¯åŠ¨å®Œæ•´æµç¨‹</a>
      <ol>
        <li><a href="#ç®€åŒ–æµç¨‹å›¾">ç®€åŒ–æµç¨‹å›¾</a></li>
        <li><a href="#è¯¦ç»†æµç¨‹å›¾">è¯¦ç»†æµç¨‹å›¾</a></li>
      </ol>
    </li>
    <li><a href="#å®é™…åº”ç”¨">å®é™…åº”ç”¨</a>
      <ol>
        <li><a href="#mainä¹‹å‰---è°ƒè¯•--ç›‘æµ‹">mainä¹‹å‰ - è°ƒè¯• &amp; ç›‘æµ‹</a>
          <ol>
            <li><a href="#xcodeæ‰“å°pre-mainçš„æ—¶é—´å¼€å‘ç¯å¢ƒxcode-dyld_print_statics--1">Xcodeæ‰“å°pre-mainçš„æ—¶é—´ï¼šå¼€å‘ç¯å¢ƒXcode DYLD_PRINT_STATICS = 1</a></li>
            <li><a href="#instrument---systemtrace--timeprofiler">Instrument - SystemTrace / TimeProfiler</a></li>
            <li><a href="#xcodeé…ç½®linkmapæ‹¿åˆ°linkmapæ–‡ä»¶åˆ†æ">Xcodeé…ç½®LinkMapï¼Œæ‹¿åˆ°LinkMapæ–‡ä»¶ï¼Œåˆ†æ</a></li>
            <li><a href="#å…¶ä»–12ä¸æ¨èå¼€æ‹“æ€è·¯">å…¶ä»–ï¼ˆ1ï¼Œ2ä¸æ¨èï¼Œå¼€æ‹“æ€è·¯ï¼‰</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#objcæºç ä¸‹è½½">objcæºç ä¸‹è½½</a>
      <ol>
        <li><a href="#objc818">objc818</a></li>
        <li><a href="#objc838">objc838</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/">
                <img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805489933_hu0cfc4d1f5c3e28c9d5ab40ace509f822_113354_800x0_resize_q75_box.jpg"
                        srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805489933_hu0cfc4d1f5c3e28c9d5ab40ace509f822_113354_800x0_resize_q75_box.jpg 800w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805489933_hu0cfc4d1f5c3e28c9d5ab40ace509f822_113354_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="484" 
                        loading="lazy"
                        alt="Featured image of post iOSåº”ç”¨ç¨‹åºåŠ è½½" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ios/" >
                iOS
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/">iOSåº”ç”¨ç¨‹åºåŠ è½½</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 25, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 9 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="å‰è¨€">å‰è¨€</h2>
<p>è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒç›®çš„æ˜¯è·Ÿç€è‹¹æœæºç ï¼Œæ·±åº¦å­¦ä¹ å¹¶ç†è§£iOS APPå¯åŠ¨è¿‡ç¨‹ã€‚</p>
<h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h2>
<h3 id="å†·å¯åŠ¨">å†·å¯åŠ¨</h3>
<p><img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693698465346.jpg"
	width="1024"
	height="200"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693698465346_hu463b78f3e15bdc2f729806aee7c07ab4_47087_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693698465346_hu463b78f3e15bdc2f729806aee7c07ab4_47087_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="512"
		data-flex-basis="1228px"
	
></p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨æ—¥å¸¸å¼€å‘æˆ–æµ‹è¯•çš„æ—¶å€™ä¸ºäº†ï¼Œè§¦å‘å†·å¯åŠ¨çŠ¶æ€ï¼Œä¼šæ‰‹åŠ¨kill appï¼Œç„¶åç‚¹å‡»å¯åŠ¨ã€‚è¿™ç§æƒ…å†µä¸‹çš„å†·å¯åŠ¨å¯èƒ½ä¼šä¸ä¸Šè¿°å†·å¯åŠ¨è¿‡ç¨‹çš„æ­¥éª¤ç¨å¾®å°‘äº›ï¼Œå¯ä»¥é…åˆInstrumentè°ƒè¯•éªŒè¯ï¼ˆè¿™ä¸ªåœ¨æ–‡ç« ç»“å°¾ä¼šåšä»‹ç»ï¼‰ã€‚å› æ­¤é€šå¸¸å¦‚æœè¦æ¨¡æ‹Ÿæ›´çœŸå®å…¨é¢çš„å†·å¯åŠ¨ï¼Œåœ¨kill appåï¼Œå†æ‰“å¼€/å¹¶ç¨å¾®ä½¿ç”¨å‡ ä¸ªå…¶ä»–appã€‚</p>
</blockquote>
<p>é€šå¸¸è¯´çš„å¯åŠ¨ï¼Œä¹Ÿæ˜¯æŒ‡çš„å†·å¯åŠ¨ï¼›å¯åŠ¨ä¼˜åŒ–å¤§éƒ¨åˆ†ä¹Ÿæ˜¯åšå†·å¯åŠ¨éƒ¨åˆ†çš„æ€§èƒ½ä¼˜åŒ– æš‚ä¸”å¯ä»¥æŠŠå†·å¯åŠ¨åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>T1: mainä¹‹å‰ï¼ŒåŠ è½½Appå¯æ‰§è¡Œæ–‡ä»¶åˆ°å†…å­˜ï¼Œç„¶åæ‰§è¡Œä¸€ç³»åˆ—çš„åŠ è½½&amp;é“¾æ¥ç­‰å·¥ä½œï¼Œæœ€åæ‰§è¡Œåˆ°main()å‡½æ•°</li>
<li>T2: mainä¹‹åï¼ŒdidFinishLaunchingä¹‹å‰ï¼Œè¿™éƒ¨åˆ†å¼€å‘æ˜¯å¯ä»¥ç›‘å¬åˆ°çš„</li>
<li>T3: didFinishLaunchingä¹‹åï¼Œå¯åŠ¨é¡µé¢å‡ºç°ä¹‹å‰ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›‘å¬çš„</li>
</ul>
<h3 id="çƒ­å¯åŠ¨">çƒ­å¯åŠ¨</h3>
<p><img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693701475567.jpg"
	width="1024"
	height="119"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693701475567_hu3fc81ab65c962d5cb0f5c57ffb0fd083_36024_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693701475567_hu3fc81ab65c962d5cb0f5c57ffb0fd083_36024_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="860"
		data-flex-basis="2065px"
	
>
çƒ­å¯åŠ¨çš„é˜¶æ®µå’ŒçŠ¶æ€éƒ½æ˜¯å¯ç›‘å¬çš„ï¼Œä¸åšè¿‡å¤šä»‹ç»ã€‚</p>
<h3 id="åº”ç”¨ç¨‹åºçš„çŠ¶æ€">åº”ç”¨ç¨‹åºçš„çŠ¶æ€</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">å¯åŠ¨ç¨‹åº
</span></span><span class="line"><span class="cl">willFinishLaunchingWithOptions
</span></span><span class="line"><span class="cl">didFinishLaunchingWithOptions
</span></span><span class="line"><span class="cl">applicationDidBecomeActive
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æŒ‰ä¸‹homeé”®
</span></span><span class="line"><span class="cl">applicationWillResignActive
</span></span><span class="line"><span class="cl">applicationDidEnterBackground
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">åŒå‡»homeé”®ï¼Œå†æ‰“å¼€ç¨‹åº
</span></span><span class="line"><span class="cl">applicationWillEnterForeground
</span></span><span class="line"><span class="cl">applicationDidBecomeActive
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç®€å•ç†è§£ç¼–è¯‘è¿‡ç¨‹">ç®€å•ç†è§£ç¼–è¯‘è¿‡ç¨‹</h2>
<p>åº”ç”¨ç¨‹åºåŠ è½½è¿‡ç¨‹ä¸­ä¼šä¾èµ–å¾ˆå¤šåº•å±‚åº“ï¼Œè¿™äº›åº•å±‚åº“å…¶å®å°±æ˜¯å¯æ‰§è¡Œçš„ä»£ç çš„äºŒè¿›åˆ¶ï¼Œè¢«æ“ä½œç³»ç»Ÿå†™å…¥åˆ°å†…å­˜ã€‚
<img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693703300492.jpg"
	width="1024"
	height="803"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693703300492_hu5ad98b908d977cd3447717802411769e_67283_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693703300492_hu5ad98b908d977cd3447717802411769e_67283_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="127"
		data-flex-basis="306px"
	
></p>
<h3 id="é™æ€åº“">é™æ€åº“</h3>
<p>æ¯”å¦‚ï¼š .a, .lib åœ¨é“¾æ¥é˜¶æ®µï¼Œä¼šå°†æ±‡ç¼–ç”Ÿæˆçš„ç›®æ ‡ä¸å¼•ç”¨çš„åº“ä¸€èµ·é“¾æ¥æ‰“åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚
<img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693703926730.jpg"
	width="1024"
	height="381"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693703926730_hu4d5db889d6f348c29503610f781360a7_35346_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693703926730_hu4d5db889d6f348c29503610f781360a7_35346_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="268"
		data-flex-basis="645px"
	
></p>
<h3 id="åŠ¨æ€åº“">åŠ¨æ€åº“</h3>
<p>æ¯”å¦‚ï¼š frameworkï¼Œ.so, .dllï¼ŒUIKIT.frameworkï¼Œ libsystemï¼Œ libdispatchï¼Œlibobjc åŠ¨æ€åº“æ ¹æ®éœ€è¦ç¼–è¯‘ï¼ŒåŠ¨æ€åŠ è½½ï¼Œåœ¨è¿è¡Œæ—¶æ‰è¢«è½½å…¥ï¼ŒèŠ‚çº¦èµ„æºï¼Œå‡å°ä½“ç§¯ã€‚
<img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693704431403.jpg"
	width="1024"
	height="510"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693704431403_hu8283e8d13025e6a6413f82e079f47b7d_40440_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693704431403_hu8283e8d13025e6a6413f82e079f47b7d_40440_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="200"
		data-flex-basis="481px"
	
></p>
<h2 id="å®šä½æ ¸å¿ƒæºç å…¥å£">å®šä½æ ¸å¿ƒæºç å…¥å£</h2>
<ol>
<li>
<p>mainå‡½æ•°ï¼Œæ–­ç‚¹å †æ ˆï¼ˆDebug/Debug Workflow/Always Show Disassembly å¼€å¯æ±‡ç¼–Debugï¼‰å¯ä»¥çœ‹åˆ°æ˜¯æœ€æ—©æ˜¯ï¼šdyldçš„start:
<img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693705094212.jpg"
	width="1024"
	height="640"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693705094212_hu440f4c49d49347e7b2265f13335d05fa_91966_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693705094212_hu440f4c49d49347e7b2265f13335d05fa_91966_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="384px"
	
></p>
</li>
<li>
<p>åœ¨ç‰¹æ®Šæ–¹æ³• + loadï¼ˆæˆ–+ (void)initializeï¼‰æ–¹æ³•ï¼Œåœ¨æ­¤æ–­ç‚¹
<img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693708417366.jpg"
	width="1024"
	height="640"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693708417366_hu440f4c49d49347e7b2265f13335d05fa_122444_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693708417366_hu440f4c49d49347e7b2265f13335d05fa_122444_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="384px"
	
></p>
</li>
</ol>
<h3 id="åˆæ¢ç»“è®º">åˆæ¢ç»“è®ºï¼š</h3>
<p>_dyld_start -&gt; +load -&gt; main -&gt; +initialize</p>
<blockquote>
<p>æºç å­¦ä¹ å°Tips</p>
<ol>
<li>OC åº•å±‚æ˜¯ C/C++/æ±‡ç¼– æ‰€ä»¥æºç å¸¸è§æœç´¢æŠ€å·§ï¼šXXXX(æˆ–è€…åˆ é™¤) XXXX:: ::XXXX XXXX(</li>
<li>ä¸»é€»è¾‘å¾ˆå¯èƒ½åœ¨ if else åˆ¤æ–­ ï¼› while / do-whileï¼› for é‡Œé¢</li>
<li>é€šè¿‡è¿”å›å€¼ - å®šä½æ ¸å¿ƒé€»è¾‘ ï¼ˆå°¤å…¶æ±‡ç¼–ï¼Œé‡ç‚¹å…³æ³¨blï¼‰</li>
<li>çœ‹å®˜æ–¹æºç ï¼Œå¤šå…³æ³¨æœ‰æ³¨é‡Šçš„åœ°æ–¹ï¼›</li>
<li>æŠ“ä¸»å¹²ï¼Œè·³è¿‡ç±»ä¼¼ check / if-returné€»è¾‘ï¼›è·³è¿‡é¢„ç¼–è¯‘éä¸»æ¶æ„é€»è¾‘ï¼ˆiosæ¶æ„ï¼šarm64ï¼‰</li>
</ol>
</blockquote>
<h3 id="__dyld_start">__dyld_start</h3>
<p>æ¥ä¸‹æ¥å°±è·Ÿç€dyldæºç  åˆæ­¥æœç´¢ _dyld_start
æœç´¢__dyld_start,åªçœ‹arm64ä¸‹çš„
<img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693710054906.jpg"
	width="1024"
	height="640"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693710054906_hu0cd249f03c5bd502fd99007d852ffcf7_175632_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693710054906_hu0cd249f03c5bd502fd99007d852ffcf7_175632_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="384px"
	
>
çœ‹ä¸æ‡‚æ±‡ç¼–æ²¡å…³ç³»ï¼Œçœ‹åé¢çš„æ³¨é‡Šï¼Œå¤§æ¦‚èƒ½æ˜ç™½å…¶å«ä¹‰ï¼Œç›´åˆ°å‡ºç°blè·³è½¬ï¼Œå†ç»“åˆå…¶æ³¨é‡Šï¼ŒåŸºæœ¬å®šä½åˆ°æ ¸å¿ƒä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// call dyldbootstrap::start(app_mh, argc, argv, slide, dyld_mh, &amp;startGlue)
</span></span><span class="line"><span class="cl">	bl	__ZN13dyldbootstrap5startEPK12macho_headeriPPKclS2_Pm
</span></span><span class="line"><span class="cl">	mov	x16,x0                  // save entry point address in x16
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœç´¢ dyldbootstrap::starï¼Œ::start æœªæœï¼ŒçŒœæµ‹Cæ–¹æ³•ï¼Œæœç´¢start( ï¼Œç¡®å®šdyld - star æœ€ç»ˆå…¥å£å‡½æ•°ã€‚
<img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693710685212.jpg"
	width="1024"
	height="640"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693710685212_huf5b6d3156f9b6fbda99e7ba95c31a878_156680_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693710685212_huf5b6d3156f9b6fbda99e7ba95c31a878_156680_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="384px"
	
>
è¿™æ ·é¦–å…ˆå¯ä»¥ç¡®è®¤æœ€ç»ˆå…¥å£æ–¹æ³•uintptr_t start(&hellip;)</p>
<h3 id="å…¥å£å‡½æ•°-uintptr_t-start">å…¥å£å‡½æ•° uintptr_t start(â€¦)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">intptr_t start(const struct macho_header* appsMachHeader, int argc, const char* argv[], 
</span></span><span class="line"><span class="cl">				intptr_t slide, const struct macho_header* dyldsMachHeader,
</span></span><span class="line"><span class="cl">				uintptr_t* startGlue)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">			// rebaseDyldIfNeeded
</span></span><span class="line"><span class="cl">    	// mach_init
</span></span><span class="line"><span class="cl">    	// apple_guard_setup
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    	return dyld::_main(appsMachHeader, appsSlide, argc, argv, envp, apple, startGlue);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ ¸å¿ƒå‡½æ•°-dyld_main">æ ¸å¿ƒå‡½æ•° dyld::_main</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">uintptr_t _main(const macho_header* mainExecutableMH, uintptr_t mainExecutableSlide,
</span></span><span class="line"><span class="cl">                int argc, const char* argv[], const char* envp[], const char* apple[], 
</span></span><span class="line"><span class="cl">                uintptr_t* startGlue) {
</span></span><span class="line"><span class="cl">    // settupEnv ç¯å¢ƒå˜é‡çš„ç›¸å…³å¤„ç†
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">        checkEnvironmentVariables(envp);
</span></span><span class="line"><span class="cl">		defaultUninitializedFallbackPaths(envp);
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">    // load shared cacheï¼ˆå…±äº«ç¼“å­˜å¤„ç†ï¼‰
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">        // load shared cache
</span></span><span class="line"><span class="cl">        checkSharedRegionDisable(...);
</span></span><span class="line"><span class="cl">        mapSharedCache();
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">    // å°†dyldåŠ åˆ°UUIDåˆ—è¡¨
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">        // add dyld itself to UUID list
</span></span><span class="line"><span class="cl">		addDyldImageToUUIDList();
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">    // ...
</span></span><span class="line"><span class="cl">    [1]reloadAllImages:
</span></span><span class="line"><span class="cl">        [1.1]mainExecutable ... (å®ä¾‹åŒ–ä¸»ç¨‹åº)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    // [1.2]load any inserted libraries (åŠ è½½ä»»ä½•æ’å…¥åŠ¨æ€åº“)
</span></span><span class="line"><span class="cl">    if	( sEnv.DYLD_INSERT_LIBRARIES != NULL ) {
</span></span><span class="line"><span class="cl">        for (const char* const* lib = sEnv.DYLD_INSERT_LIBRARIES; *lib != NULL; ++lib) 
</span></span><span class="line"><span class="cl">            loadInsertedDylib(*lib);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    // [1.3.1]link main executable (é“¾æ¥åº“)
</span></span><span class="line"><span class="cl">    link(sMainExecutable, sEnv.DYLD_BIND_AT_LAUNCH, true, ImageLoader::RPathChain(NULL, NULL), -1);
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    // [1.3.2]link any inserted libraries
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    // [2]run all initializers (è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–ç¨‹åº)
</span></span><span class="line"><span class="cl">	initializeMainExecutable();
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    // [3]notify any montoring proccesses that this process is about to enter main()
</span></span><span class="line"><span class="cl">    (é€šçŸ¥ç›‘å¬dyld-main)
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    notifyMonitoringDyldMain();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="dyldæ ¸å¿ƒæºç æµç¨‹">dyldæ ¸å¿ƒæºç æµç¨‹</h2>
<h3 id="reloadallimages">reloadAllImages</h3>
<h4 id="å®ä¾‹åŒ–ä¸»ç¨‹åº">å®ä¾‹åŒ–ä¸»ç¨‹åº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">static ImageLoaderMachO* instantiateFromLoadedImage(const macho_header* mh, uintptr_t slide, const char* path)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	// try mach-o loader
</span></span><span class="line"><span class="cl">	if ( isCompatibleMachO((const uint8_t*)mh, path) ) {
</span></span><span class="line"><span class="cl">		ImageLoader* image = ImageLoaderMachO::instantiateMainExecutable(mh, slide, path, gLinkContext);
</span></span><span class="line"><span class="cl">		addImage(image);
</span></span><span class="line"><span class="cl">		return (ImageLoaderMachO*)image;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// create image for main executable
</span></span><span class="line"><span class="cl">ImageLoader* ImageLoaderMachO::instantiateMainExecutable(const macho_header* mh, uintptr_t slide, const char* path, const LinkContext&amp; context)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">   ....
</span></span><span class="line"><span class="cl">	bool compressed;
</span></span><span class="line"><span class="cl">	unsigned int segCount; // æ®µçš„æ•°é‡
</span></span><span class="line"><span class="cl">	unsigned int libCount; // libåº“çš„æ•°é‡
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">	sniffLoadCommands(mh, path, false, &amp;compressed, &amp;segCount, &amp;libCount, context, &amp;codeSigCmd, &amp;encryptCmd);
</span></span><span class="line"><span class="cl">	// instantiate concrete class based on content of load commands
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><code>instantiateFromLoadedImage</code> -&gt;<code>instantiateMainExecutable</code> -&gt;<code>sniffLoadCommands</code></li>
<li><code>addImage</code></li>
</ol>
<h4 id="åŠ è½½ä»»ä½•æ’å…¥åŠ¨æ€åº“">åŠ è½½ä»»ä½•æ’å…¥åŠ¨æ€åº“</h4>
<p>åœ¨uintptr_t _main(â€¦) å‡½æ•°æœ‰å¦‚ä¸‹æ ¸å¿ƒæµç¨‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// load any inserted libraries
</span></span><span class="line"><span class="cl">if	( sEnv.DYLD_INSERT_LIBRARIES != NULL ) {
</span></span><span class="line"><span class="cl">	for (const char* const* lib = sEnv.DYLD_INSERT_LIBRARIES; *lib != NULL; ++lib) 
</span></span><span class="line"><span class="cl">		loadInsertedDylib(*lib);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>loadInsertedDylib</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// ä½¿ç”¨åŠ¨æ€åº“æ³¨å…¥ä»£ç å¯ä»¥å‚è€ƒè¿™ä¸ª
</span></span><span class="line"><span class="cl">static void loadInsertedDylib(const char* path)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	ImageLoader* image = NULL;
</span></span><span class="line"><span class="cl">	unsigned cacheIndex;
</span></span><span class="line"><span class="cl">	try {
</span></span><span class="line"><span class="cl">		LoadContext context;
</span></span><span class="line"><span class="cl">        context.useSearchPaths		= false;
</span></span><span class="line"><span class="cl">		...
</span></span><span class="line"><span class="cl">		image = load(path, context, cacheIndex);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	catch (const char* msg) {
</span></span><span class="line"><span class="cl">		...
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±å®Œæˆäº†å°†libåº“ä»¥é•œåƒæ–‡ä»¶çš„å½¢å¼åŠ è½½è¿›æ¥äº†ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„Imageï¼Œåªéœ€è¦åœ¨åˆé€‚çš„åœ°æ–¹è¿›è¡Œæ˜ å°„å³å¯ã€‚</p>
<h4 id="é“¾æ¥åº“">é“¾æ¥åº“</h4>
<p>åœ¨uintptr_t _main(â€¦) å‡½æ•°æœ‰å¦‚ä¸‹æ ¸å¿ƒæµç¨‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// link any inserted libraries
</span></span><span class="line"><span class="cl">// do this after linking main executable so that any dylibs pulled in by inserted 
</span></span><span class="line"><span class="cl">// dylibs (e.g. libSystem) will not be in front of dylibs the program uses
</span></span><span class="line"><span class="cl">if ( sInsertedDylibCount &gt; 0 ) {
</span></span><span class="line"><span class="cl">    for(unsigned int i=0; i &lt; sInsertedDylibCount; ++i) {
</span></span><span class="line"><span class="cl">        ImageLoader* image = sAllImages[i+1];
</span></span><span class="line"><span class="cl">        link(image, sEnv.DYLD_BIND_AT_LAUNCH, true, ImageLoader::RPathChain(NULL, NULL), -1);
</span></span><span class="line"><span class="cl">        image-&gt;setNeverUnloadRecursive();
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    // only INSERTED libraries can interpose
</span></span><span class="line"><span class="cl">    // register interposing info after all inserted libraries are bound so chaining works
</span></span><span class="line"><span class="cl">    for(unsigned int i=0; i &lt; sInsertedDylibCount; ++i) {
</span></span><span class="line"><span class="cl">        ImageLoader* image = sAllImages[i+1];
</span></span><span class="line"><span class="cl">        image-&gt;registerInterposing(gLinkContext);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">// Bind and notify for the inserted images now interposing has been registered
</span></span><span class="line"><span class="cl">if ( sInsertedDylibCount &gt; 0 ) {
</span></span><span class="line"><span class="cl">    for(unsigned int i=0; i &lt; sInsertedDylibCount; ++i) {
</span></span><span class="line"><span class="cl">        ImageLoader* image = sAllImages[i+1];
</span></span><span class="line"><span class="cl">        image-&gt;recursiveBind(gLinkContext, sEnv.DYLD_BIND_AT_LAUNCH, true);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="éå†-link-images">éå† link images</h5>
<ul>
<li>æ ¹æ®loadInsertedDylib åçš„ sInsertedDylibCountï¼Œéå†å·²ç»åŠ è½½çš„åŠ¨æ€åº“ï¼›</li>
<li>æ ¹æ®ImageLoaderMachO::instantiateMainExecutable -&gt; sAllImageséå†æ‰§è¡Œ ImageLoader* image = sAllImages[i+1];ï¼›</li>
<li>link image
<ul>
<li>é€’å½’æ“ä½œ</li>
</ul>
</li>
</ul>
<h5 id="é€’å½’æ’å…¥åŠ è½½">é€’å½’æ’å…¥/åŠ è½½</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void ImageLoader::link(const LinkContext&amp; context, bool forceLazysBound, bool preflightOnly, bool neverUnload, const RPathChain&amp; loaderRPaths, const char* imagePath)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">    // é€’å½’åŠ è½½
</span></span><span class="line"><span class="cl">	this-&gt;recursiveLoadLibraries(context, preflightOnly, loaderRPaths, imagePath);
</span></span><span class="line"><span class="cl">	context.notifyBatch(dyld_image_state_dependents_mapped, preflightOnly);
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">	// é€’å½’åˆ·æ–°ä¾èµ–åº“çš„å±‚çº§
</span></span><span class="line"><span class="cl">	this-&gt;recursiveUpdateDepth(context.imageCount());
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // ç¬¦å·ç»‘å®š
</span></span><span class="line"><span class="cl">	__block uint64_t t2, t3, t4, t5;
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">		this-&gt;recursiveRebase(context);
</span></span><span class="line"><span class="cl">		context.notifyBatch(dyld_image_state_rebased, false);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		t3 = mach_absolute_time();
</span></span><span class="line"><span class="cl">		if ( !context.linkingMainExecutable )
</span></span><span class="line"><span class="cl">			this-&gt;recursiveBindWithAccounting(context, forceLazysBound, neverUnload);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		t4 = mach_absolute_time();
</span></span><span class="line"><span class="cl">		if ( !context.linkingMainExecutable )
</span></span><span class="line"><span class="cl">			this-&gt;weakBind(context);
</span></span><span class="line"><span class="cl">		t5 = mach_absolute_time();
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">	this-&gt;recursiveGetDOFSections(context, dofs);
</span></span><span class="line"><span class="cl">	context.registerDOFs(dofs);
</span></span><span class="line"><span class="cl">	uint64_t t7 = mach_absolute_time();	
</span></span><span class="line"><span class="cl">	// interpose any dynamically loaded images
</span></span><span class="line"><span class="cl">	if ( !context.linkingMainExecutable &amp;&amp; (fgInterposingTuples.size() != 0) ) {
</span></span><span class="line"><span class="cl">		dyld3::ScopedTimer timer(DBG_DYLD_TIMING_APPLY_INTERPOSING, 0, 0, 0);
</span></span><span class="line"><span class="cl">		this-&gt;recursiveApplyInterposing(context);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–ç¨‹åº---run-all-initializers">è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–ç¨‹åº - run all initializers</h3>
<ol>
<li>æ‰§è¡Œæ‰€æœ‰æ’å…¥çš„dylibæ‰§è¡Œåˆå§‹åŒ–</li>
<li>æ‰§è¡Œä¸»ç¨‹åºåˆå§‹åŒ–</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void initializeMainExecutable()
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    ....
</span></span><span class="line"><span class="cl">	// run initialzers for any inserted dylibs
</span></span><span class="line"><span class="cl">	ImageLoader::InitializerTimingList initializerTimes[allImagesCount()];
</span></span><span class="line"><span class="cl">	initializerTimes[0].count = 0;
</span></span><span class="line"><span class="cl">	const size_t rootCount = sImageRoots.size();
</span></span><span class="line"><span class="cl">	if ( rootCount &gt; 1 ) {
</span></span><span class="line"><span class="cl">		for(size_t i=1; i &lt; rootCount; ++i) {
</span></span><span class="line"><span class="cl">			sImageRoots[i]-&gt;runInitializers(gLinkContext, initializerTimes[0]);
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	// run initializers for main executable and everything it brings up 
</span></span><span class="line"><span class="cl">	sMainExecutable-&gt;runInitializers(gLinkContext, initializerTimes[0]);
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="runinitializers">runInitializers</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void ImageLoader::runInitializers(const LinkContext&amp; context, InitializerTimingList&amp; timingInfo)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">	processInitializers(context, thisThread, timingInfo, up);
</span></span><span class="line"><span class="cl">	context.notifyBatch(dyld_image_state_initialized, false);
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">void ImageLoader::processInitializers(const LinkContext&amp; context, mach_port_t thisThread,
</span></span><span class="line"><span class="cl">									 InitializerTimingList&amp; timingInfo, ImageLoader::UninitedUpwards&amp; images)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    // åˆå§‹åŒ–å‡†å¤‡
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">	// Calling recursive init on all images in images list, building a new list of
</span></span><span class="line"><span class="cl">	// uninitialized upward dependencies.
</span></span><span class="line"><span class="cl">    // éå†åˆå§‹åŒ–
</span></span><span class="line"><span class="cl">	for (uintptr_t i=0; i &lt; images.count; ++i) {
</span></span><span class="line"><span class="cl">        // é€’å½’ï¼Œä¸€ä¸ªä¸ªåˆå§‹åŒ–
</span></span><span class="line"><span class="cl">		images.images[i]-&gt;recursiveInitialization(context, thisThread, images.images[i]-&gt;getPath(), timingInfo, ups);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="recursiveinitialization">recursiveInitialization</h5>
<p><code>notifySingle</code>ï¼Œé€šçŸ¥<code>dyld_image_states</code>çŠ¶æ€çš„æ”¹å˜ <code>doInitialization</code>ï¼Œ å®Œæˆåˆå§‹åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void ImageLoader::recursiveInitialization(const LinkContext&amp; context, mach_port_t this_thread, const char* pathToInitialize,
</span></span><span class="line"><span class="cl">										  InitializerTimingList&amp; timingInfo, UninitedUpwards&amp; uninitUps)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	recursive_lock lock_info(this_thread);
</span></span><span class="line"><span class="cl">	recursiveSpinLock(lock_info);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	if ( fState &lt; dyld_image_state_dependents_initialized-1 ) {
</span></span><span class="line"><span class="cl">		uint8_t oldState = fState;
</span></span><span class="line"><span class="cl">		// break cycles
</span></span><span class="line"><span class="cl">		fState = dyld_image_state_dependents_initialized-1;
</span></span><span class="line"><span class="cl">		try {
</span></span><span class="line"><span class="cl">			// initialize lower level libraries first
</span></span><span class="line"><span class="cl">			....
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			// let objc know we are about to initialize this image
</span></span><span class="line"><span class="cl">            ....
</span></span><span class="line"><span class="cl">			context.notifySingle(dyld_image_state_dependents_initialized, this, &amp;timingInfo);
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			// initialize this image
</span></span><span class="line"><span class="cl">			bool hasInitializers = this-&gt;doInitialization(context);
</span></span><span class="line"><span class="cl">            // let anyone know we finished initializing this image
</span></span><span class="line"><span class="cl">            ....
</span></span><span class="line"><span class="cl">			context.notifySingle(dyld_image_state_initialized, this, NULL);
</span></span><span class="line"><span class="cl">			....
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	recursiveSpinUnLock();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="doinitialization">doInitialization</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">bool ImageLoaderMachO::doInitialization(const LinkContext&amp; context)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    ....
</span></span><span class="line"><span class="cl">	// mach-o has -init and static initializers
</span></span><span class="line"><span class="cl">	doImageInit(context);
</span></span><span class="line"><span class="cl">	doModInitFunctions(context);
</span></span><span class="line"><span class="cl">    ....
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">void ImageLoaderMachO::doModInitFunctions(const LinkContext&amp; context)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	if ( fHasInitializers ) {
</span></span><span class="line"><span class="cl">		const uint32_t cmd_count = ((macho_header*)fMachOData)-&gt;ncmds;
</span></span><span class="line"><span class="cl">		const struct load_command* const cmds = (struct load_command*)&amp;fMachOData[sizeof(macho_header)];
</span></span><span class="line"><span class="cl">		const struct load_command* cmd = cmds;
</span></span><span class="line"><span class="cl">		for (uint32_t i = 0; i &lt; cmd_count; ++i) {
</span></span><span class="line"><span class="cl">			if ( cmd-&gt;cmd == LC_SEGMENT_COMMAND ) {
</span></span><span class="line"><span class="cl">				for (const struct macho_section* sect=sectionsStart; sect &lt; sectionsEnd; ++sect) {
</span></span><span class="line"><span class="cl">					const uint8_t type = sect-&gt;flags &amp; SECTION_TYPE;
</span></span><span class="line"><span class="cl">					...
</span></span><span class="line"><span class="cl">                    Initializer* inits = (Initializer*)(sect-&gt;addr + fSlide);
</span></span><span class="line"><span class="cl">                    ...
</span></span><span class="line"><span class="cl">                    for (size_t j=0; j &lt; count; ++j) {
</span></span><span class="line"><span class="cl">                        Initializer func = inits[j];
</span></span><span class="line"><span class="cl">                        ....
</span></span><span class="line"><span class="cl">                    }
</span></span><span class="line"><span class="cl">                    ....
</span></span><span class="line"><span class="cl">				}
</span></span><span class="line"><span class="cl">			}
</span></span><span class="line"><span class="cl">			cmd = (const struct load_command*)(((char*)cmd)+cmd-&gt;cmdsize);
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="notifysingle">notifySingle</h5>
<p>è¿™é‡Œ(*sNotifyObjCInit)(image-&gt;getRealPath(), image-&gt;machHeader());å°±æ˜¯è·å–å‡½æ•°æŒ‡é’ˆåœ°å€ï¼Œæ‰§è¡Œå¯¹åº”çš„å‡½æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">static void notifySingle(dyld_image_states state, const ImageLoader* image, ImageLoader::InitializerTimingList* timingInfo)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">   //dyld::log(&#34;notifySingle(state=%d, image=%s)\n&#34;, state, image-&gt;getPath());
</span></span><span class="line"><span class="cl">   ....
</span></span><span class="line"><span class="cl">   if ( state == dyld_image_state_mapped ) {
</span></span><span class="line"><span class="cl">   	....
</span></span><span class="line"><span class="cl">   }
</span></span><span class="line"><span class="cl">   if ( (state == dyld_image_state_dependents_initialized) &amp;&amp; (sNotifyObjCInit != NULL) &amp;&amp; image-&gt;notifyObjC() ) {
</span></span><span class="line"><span class="cl">   	....
</span></span><span class="line"><span class="cl">       (*sNotifyObjCInit)(image-&gt;getRealPath(), image-&gt;machHeader());
</span></span><span class="line"><span class="cl">   	....
</span></span><span class="line"><span class="cl">   }
</span></span><span class="line"><span class="cl">   // mach message csdlc about dynamically unloaded images
</span></span><span class="line"><span class="cl">   if ( image-&gt;addFuncNotified() &amp;&amp; (state == dyld_image_state_terminated) ) {
</span></span><span class="line"><span class="cl">   	....
</span></span><span class="line"><span class="cl">   	notifyMonitoringDyld(true, 1, loadAddress, loadPath);
</span></span><span class="line"><span class="cl">   }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥åˆ°æ­¤ï¼Œå¯ä»¥çœ‹å‡º<code>sNotifyObjCInit</code>æ˜¯ä¸€ä¸ªcå‡½æ•°æŒ‡é’ˆåœ°å€ï¼Œdyldé€šè¿‡è·å–åˆ°<code>libobjc</code>å‡½æ•°æŒ‡é’ˆï¼Œå¯ä»¥æ‰§è¡Œåˆ°<code>libobjc</code>é‡Œé¢ã€‚ åœ¨dyldæºç ä¸­å…¨å±€æœç´¢<code>sNotifyObjCInit</code>,å¯ä»¥æ‰¾åˆ°<code>sNotifyObjCInit</code>èµ‹å€¼çš„åœ°æ–¹å‘ç”Ÿåœ¨<code>registerObjCNotifiers</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void registerObjCNotifiers(_dyld_objc_notify_mapped mapped, _dyld_objc_notify_init init, _dyld_objc_notify_unmapped unmapped)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	// record functions to call
</span></span><span class="line"><span class="cl">	sNotifyObjCMapped	= mapped;
</span></span><span class="line"><span class="cl">	sNotifyObjCInit		= init;
</span></span><span class="line"><span class="cl">	sNotifyObjCUnmapped = unmapped;
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">	// &lt;rdar://problem/32209809&gt; call &#39;init&#39; function on all images already init&#39;ed (below libSystem)
</span></span><span class="line"><span class="cl">	for (std::vector&lt;ImageLoader*&gt;::iterator it=sAllImages.begin(); it != sAllImages.end(); it++) {
</span></span><span class="line"><span class="cl">		ImageLoader* image = *it;
</span></span><span class="line"><span class="cl">		if ( (image-&gt;getState() == dyld_image_state_initialized) &amp;&amp; image-&gt;notifyObjC() ) {
</span></span><span class="line"><span class="cl">			dyld3::ScopedTimer timer(DBG_DYLD_TIMING_OBJC_INIT, (uint64_t)image-&gt;machHeader(), 0, 0);
</span></span><span class="line"><span class="cl">			(*sNotifyObjCInit)(image-&gt;getRealPath(), image-&gt;machHeader());
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">void _dyld_objc_notify_register(_dyld_objc_notify_mapped    mapped,
</span></span><span class="line"><span class="cl">                                _dyld_objc_notify_init      init,
</span></span><span class="line"><span class="cl">                                _dyld_objc_notify_unmapped  unmapped)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	dyld::registerObjCNotifiers(mapped, init, unmapped);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›ä¸€æ­¥åœ¨dyldä¸­æŸ¥æ‰¾<code>registerObjCNotifiers</code>,<code>_dyld_objc_notify_register</code>ï¼Œå¯ä»¥åˆ†æå‡ºï¼Œè¿™ä¸ª<code>register</code>å‡½æ•°æ˜¯<code>extern</code>ï¼Œå¹¶ä¸æ˜¯åœ¨dyldå‘èµ·è°ƒç”¨çš„ã€‚è‡³äºåˆ°åº•åœ¨å“ªé‡Œè°ƒç”¨ï¼Œåé¢ä¼šè¯¦ç»†è¯´æ˜ã€‚</p>
<h3 id="å›è°ƒç›‘å¬">å›è°ƒç›‘å¬</h3>
<h4 id="å¯ä»¥çŒœæµ‹æµç¨‹">å¯ä»¥çŒœæµ‹æµç¨‹</h4>
<p>åˆ°æ­¤å¯ä»¥çŒœæµ‹ï¼Œ<code>dyld -&gt; libobjc</code> çš„æ–¹å¼æ˜¯é€šè¿‡è¿™ç§å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼è¿›è¡Œé€šä¿¡, åº”è¯¥æ˜¯libobjcåœ¨æŸä¸ªåœ°æ–¹è¿›è¡Œäº†<code>registerObjCNotifiers</code>ï¼Œè¿™æ ·<code>dyld start</code>åï¼Œæ ¹æ®ä¸Šè¿°æµç¨‹ï¼Œå³å¯è·³è½¬åˆ°libobjcã€‚è¿™ç§ä¸åŒåº“ä¹‹é—´ <code>register-notify</code>çš„æ–¹å¼è¿›è¡Œé€šä¿¡çš„å®Œæˆä»£ç è°ƒç”¨çš„ï¼Œæ˜æ˜¾ä»£ç åœ¨ä¸€ä¸ªåº“é‡Œé¢ä¸€è¡Œè¡Œè·Ÿè¿›ä»£ç æ˜¯è¡Œä¸é€šçš„ã€‚æ‰€ä»¥æ¥ä¸‹æ¥éœ€è¦æ‹ä¸€ä¸‹æ€è·¯ã€‚</p>
<h4 id="æå‡ºç–‘é—®">æå‡ºç–‘é—®</h4>
<p>é‚£ä¹ˆç°åœ¨æœ‰ç–‘é—®</p>
<ol>
<li>OCæ€ä¹ˆå°†è‡ªå·±çš„å‡½æ•°æŒ‡é’ˆä¼ ç»™dyldçš„å‘¢ï¼Ÿ</li>
<li>OCåˆæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å®Œæˆæ³¨å†Œçš„å‘¢ï¼Ÿ</li>
<li>OC-dyldä¹‹é—´çš„ç›¸äº’é€šä¿¡æ˜¯å¦‚ä½•é…åˆçš„å‘¢ï¼Ÿ</li>
</ol>
<h2 id="libobjc-å¯åŠ¨æ ¸å¿ƒæºç åˆ†æ">libobjc å¯åŠ¨æ ¸å¿ƒæºç åˆ†æ</h2>
<p>ç›´æ¥ä»è‹¹æœå®˜ç½‘ä¸‹è½½libobjcæºç ã€‚</p>
<h3 id="æ‰¾åˆ°-_dyld_objc_notify_register-å…¥å£">æ‰¾åˆ° _dyld_objc_notify_register å…¥å£</h3>
<p>åœ¨dyldæºç åˆ†æä¸­ï¼Œèƒ½çœ‹å‡ºlibobjcæ˜¯é€šè¿‡ è°ƒç”¨_dyld_objc_notify_registeræ¥å®Œæˆæ³¨å†Œçš„ã€‚åœ¨libobjcæºç ä¸­æœç´¢_dyld_objc_notify_register,å‘ç°å…¶åœ¨_objc_inité‡Œè°ƒç”¨ï¼Œå®Œæˆçš„å‘dyldæ³¨å†Œå‡½æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void _objc_init(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    ....
</span></span><span class="line"><span class="cl">    _dyld_objc_notify_register(&amp;map_images, load_images, unmap_image);
</span></span><span class="line"><span class="cl">    ....
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡<code>_dyld_objc_notify_register(&amp;map_images, load_images, unmap_image)</code> å¯ä»¥å¿«é€Ÿè§£ç­”äº†å‰é¢é—®é¢˜1ï¼ˆä»€ä¹ˆæ—¶å€™æ³¨å†Œï¼‰å’Œé—®é¢˜2ï¼ˆå¦‚ä½•æ³¨å†Œï¼‰ã€‚ å¹¶ä¸”æˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°dyldé‡Œé¢çš„<code>sNotifyObjCInit</code>å³æ˜¯<code>libobjc</code>çš„<code>load_images</code>å‡½æ•°ï¼Œ<code>sNotifyObjCMapped</code>æ˜¯<code>map_images</code>å‡½æ•°ã€‚ ç°åœ¨åˆæœ‰æ–°çš„é—®é¢˜äº§ç”Ÿäº†ï¼Œè™½ç„¶æ˜ç¡®äº†<code>libobjc</code>å‘<code>dyld</code>æ³¨å†Œå‡½æ•°å‘ç”Ÿåœ¨<code>_objc_init</code>é‡Œé¢ï¼Œä½†æ˜¯<code>_objc_init</code>åˆ°åº•ä»€ä¹ˆæ—¶å€™è§¦å‘çš„è¿˜æ˜¯ä¸çŸ¥é“ã€‚</p>
<h3 id="build--run-libobjc">build &amp; run libobjc</h3>
<p>ç„¶åæ ¹æ®è‡ªå·±çš„Xcodeå’Œç³»ç»Ÿç‰ˆæœ¬ï¼Œå°†libobjcæºç buildï¼Œå¹¶runèµ·æ¥ã€‚è¿™é‡Œå°±ä¸åšè¯¦ç»†ä»‹ç»ï¼‰</p>
<blockquote>
<p><a class="link" href="objc818-canrun.zip" >objc818-canrun for Bigsur</a>
<a class="link" href="objc818-canrun.zip" >objc838-canrun for Monterey</a>
åœ¨è¿™é‡Œå¯ä»¥è‡ªå·±æ ¹æ®å½“å‰ç¯å¢ƒæ‰¾ä¸€ä¸ªæºç å°è¯•è·‘ä¸€ä¸ªã€‚
è·‘æºç ç®€å•çš„æ€è·¯å°±æ˜¯åœ¨githubä¸ŠæŠŠæºç downä¸‹æ¥ï¼Œç„¶åç›´æ¥buildï¼Œé‚£ç§æ‰¾ä¸åˆ°ç¬¦å·çš„æŠ¥é”™ç›´æ¥å…ˆæ³¨é‡Šï¼Œæ‰¾ä¸åˆ°æ–‡ä»¶çš„å»appleçš„open sourceæœç´¢ä¸‹ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±æ·»åŠ åˆ°è‡ªå·±çš„å·¥ç¨‹ä¸‹é¢ã€‚åŸºæœ¬è¿™æ ·æ“ä½œå®Œäº†ï¼Œå°±æ²¡erroräº†ï¼Œç„¶åæ–°å»ºä¸€ä¸ªtarget, å°†objcåº“æ·»åŠ åˆ°targetçš„Dependencies é‡Œé¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
<img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693800524951.jpg"
	width="1024"
	height="640"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693800524951_hu081b45b4958526e060399f25c13811d4_97727_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693800524951_hu081b45b4958526e060399f25c13811d4_97727_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="384px"
	
></p>
</blockquote>
<p>ä¸ºäº†æ˜ç¡®_objc_initçš„è°ƒç”¨æ—¶æœºï¼Œç®€å•çš„æ€è·¯å°±æ˜¯åœ¨_objc_inité‡Œé¢åŠ ä¸€ä¸ªæ–­ç‚¹ï¼Œçœ‹å †æ ˆã€‚</p>
<p><img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693801720569.jpg"
	width="1024"
	height="640"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693801720569_hub0f813d565a6228ad7209a42a9b7f8b5_197975_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693801720569_hub0f813d565a6228ad7209a42a9b7f8b5_197975_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="384px"
	
></p>
<h3 id="ç¡®è®¤åŸºç¡€æµç¨‹">ç¡®è®¤åŸºç¡€æµç¨‹</h3>
<p><code>dyld</code> -&gt;<code>libsystem</code> -&gt;<code>libdispatch</code> -&gt;<code>libobjc</code> -&gt;<code>_objc_init</code></p>
<p>ä»æ‰“å°çš„è¯¦ç»†å †æ ˆä¿¡æ¯çœ‹ï¼Œ<code>dyld_dyld_start</code>-&gt; â€¦. -&gt;<code>ImageLoaderMachO::doModInitFunction</code>è¿™ä¸ªè¿‡ç¨‹çš„æµç¨‹æ­£å¥½è·Ÿå‰é¢dyld æºç åˆ†æçš„è¿‡ç¨‹å»åˆä¸Šäº†ã€‚åé¢æ˜¯<code>libSystem.B.dylib</code> <code>libSystem_initializer</code>(çŒœæµ‹è¿™ä¸ªè¿‡ç¨‹åº”è¯¥æ˜¯<code>doModInitFunction</code>é‡Œé¢è°ƒèµ·çš„) -&gt;<code>libdispatch</code>-&gt;<code>libobjc</code></p>
<p>åœ¨<code>dyld</code>ä¸­çš„æœç´¢<code>image-&gt;getRealPath()</code> åŸºæœ¬å¯ä»¥ç¡®å®š<code>libobjc</code>æ³¨å†Œçš„å‡½æ•°çš„è°ƒç”¨æ—¶æœºã€‚åœ¨<code>notifyBatchPartial</code>å’Œ<code>notifySingle</code>æ ¹æ®<code>dyld_image_states</code>è§¦å‘ä¸åŒçš„æ³¨å†Œå‡½æ•°ã€‚</p>
<blockquote>
<p>dyld_image_state_bound è§¦å‘ libjobcmap_images dyld_image_state_initialized è§¦å‘libobjc load_images</p>
</blockquote>
<h2 id="éªŒè¯æµç¨‹---é…åˆlibsytemæºç libdispatchæºç ">éªŒè¯æµç¨‹ - é…åˆlibSytemæºç ï¼Œlibdispatchæºç </h2>
<p>åœ¨å‰é¢<code>dyld</code>å·²ç»åˆ†æåˆ°äº†<code>doModInitFunctions</code>é‡Œé¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">Initializer* inits = (Initializer*)(sect-&gt;addr + fSlide);
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">Initializer func = inits[j];
</span></span><span class="line"><span class="cl">// &lt;rdar://problem/8543820&amp;9228031&gt; verify initializers are in image
</span></span><span class="line"><span class="cl">if ( ! this-&gt;containsAddress(stripPointer((void*)func)) ) {
</span></span><span class="line"><span class="cl">  dyld::throwf(&#34;initializer function %p not in mapped image for %s\n&#34;, func, this-&gt;getPath());
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">if ( ! dyld::gProcessInfo-&gt;libSystemInitialized ) {
</span></span><span class="line"><span class="cl">  // &lt;rdar://problem/17973316&gt; libSystem initializer must run first
</span></span><span class="line"><span class="cl">  const char* installPath = getInstallPath();
</span></span><span class="line"><span class="cl">  if ( (installPath == NULL) || (strcmp(installPath, LIBSYSTEM_DYLIB_PATH) != 0) )
</span></span><span class="line"><span class="cl">    dyld::throwf(&#34;initializer in image (%s) that does not link with libSystem.dylib\n&#34;, this-&gt;getPath());
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">if ( context.verboseInit )
</span></span><span class="line"><span class="cl">  dyld::log(&#34;dyld: calling initializer function %p in %s\n&#34;, func, this-&gt;getPath());
</span></span><span class="line"><span class="cl">bool haveLibSystemHelpersBefore = (dyld::gLibSystemHelpers != NULL);
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  dyld3::ScopedTimer(DBG_DYLD_TIMING_STATIC_INITIALIZER, (uint64_t)fMachOData, (uint64_t)func, 0);
</span></span><span class="line"><span class="cl">  func(context.argc, context.argv, context.envp, context.apple, &amp;context.programVars);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°<code>dyld</code>ç¡®å®è¦èµ°å¹¶ç¡®å®šå…ˆåˆ°<code>libSystem</code>çš„<code>initializer</code></p>
<h3 id="dyld-åˆå§‹åŒ–å¿…é¡»ç¡®ä¿å…ˆå®Œæˆ-libsystem-åˆå§‹åŒ–">dyld åˆå§‹åŒ–å¿…é¡»ç¡®ä¿å…ˆå®Œæˆ libSystem åˆå§‹åŒ–</h3>
<p>å›åˆ°dyld çš„doModInitFunctionsçš„éƒ¨åˆ†ä»£ç </p>
<h3 id="libsytem-initializer">libSytem initializer</h3>
<p>å†åˆ°<code>libSystem</code>æºç ä¸­æœç´¢<code>initializer</code>ï¼Œç¡®å®šå…¥å£ <code>libSystem_initializer</code>,æ¥ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªä¸ªæ–¹æ³•è·Ÿè¸ªæŸ¥çœ‹ï¼Œæœ€ç»ˆå¯ä»¥çœ‹å‡ºæµç¨‹ä¸º <code>libSystem_initializer</code>-&gt; <code>libdispatch_init</code></p>
<h3 id="libdispatch_init">libdispatch_init</h3>
<p>åˆ°<code>libdispatch</code>æºç ä¸­å¸¸è§„åˆ†ææ€è·¯ï¼Œæœ€ç»ˆæµç¨‹ä¸º <code>libdispatch_init</code>-&gt; <code>_os_object_init</code>-&gt; <code>_objc_init</code> åˆ°è¿™é‡Œï¼Œé€šè¿‡æºç ä¹ŸéªŒè¯äº† ä¸Šè¿°å †æ ˆçš„æµç¨‹ã€‚</p>
<h2 id="å¯åŠ¨å®Œæ•´æµç¨‹">å¯åŠ¨å®Œæ•´æµç¨‹</h2>
<h3 id="ç®€åŒ–æµç¨‹å›¾">ç®€åŒ–æµç¨‹å›¾</h3>
<p><img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805296135.jpg"
	width="1024"
	height="549"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805296135_hu20f457bb2a495be92f7cd7b0e4eb4e26_56472_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805296135_hu20f457bb2a495be92f7cd7b0e4eb4e26_56472_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="186"
		data-flex-basis="447px"
	
></p>
<h3 id="è¯¦ç»†æµç¨‹å›¾">è¯¦ç»†æµç¨‹å›¾</h3>
<p><img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805489933.jpg"
	width="1024"
	height="619"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805489933_hu0cfc4d1f5c3e28c9d5ab40ace509f822_113354_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805489933_hu0cfc4d1f5c3e28c9d5ab40ace509f822_113354_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="165"
		data-flex-basis="397px"
	
></p>
<h2 id="å®é™…åº”ç”¨">å®é™…åº”ç”¨</h2>
<h3 id="mainä¹‹å‰---è°ƒè¯•--ç›‘æµ‹">mainä¹‹å‰ - è°ƒè¯• &amp; ç›‘æµ‹</h3>
<h4 id="xcodeæ‰“å°pre-mainçš„æ—¶é—´å¼€å‘ç¯å¢ƒxcode-dyld_print_statics--1">Xcodeæ‰“å°pre-mainçš„æ—¶é—´ï¼šå¼€å‘ç¯å¢ƒXcode DYLD_PRINT_STATICS = 1</h4>
<p><img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805852615.jpg"
	width="1024"
	height="278"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805852615_hub2a93ebef1094fa0f88cc40e01cee0d2_101974_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693805852615_hub2a93ebef1094fa0f88cc40e01cee0d2_101974_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="368"
		data-flex-basis="884px"
	
></p>
<ol>
<li><code>dylid loading time</code>:åŠ¨æ€åº“åŠ è½½æ—¶é—´ï¼Œè½½å…¥åŠ¨æ€åº“,å°½å¯èƒ½ä½¿ç”¨ç³»ç»Ÿåº“,è‡ªå®šä¹‰åº“ï¼Œæœ€å¥½ä¸è¦å¤§äº6ä¸ªï¼ˆappleæ¨èï¼‰</li>
<li>rebaseï¼ˆä¿®æ­£åç§»æŒ‡é’ˆ ASLR-ä¿®å¤å†…éƒ¨æŒ‡é’ˆï¼‰ / binding time ï¼ˆå¤–éƒ¨ç¬¦å·ç»‘å®šï¼‰:ï¼ˆfishhookï¼‰</li>
<li><code>Objc set up time</code>ï¼Œ å‡å°‘OCç±»ï¼Œæœ‰ç»Ÿè®¡2ä¸‡ä¸ªocç±»å¢åŠ 800æ¯«ç§’ï¼Œswiftæ¯”OCçš„æ•ˆç‡æ›´é«˜ï¼Œåˆ é™¤å¼ƒç”¨çš„ç±»ï¼ˆæ‰¾å·¥å…·æ£€æµ‹ï¼‰</li>
<li><code>initializer time load</code>æ–¹æ³• æ‡’åŠ è½½ï¼Œå°½é‡æ”¾åœ¨<code>initialize</code> å»è°ƒç”¨</li>
<li><code>slowest initializer</code>:æœ€æ…¢çš„å‡ ä¸ªåº“çš„æ—¶é—´</li>
<li><code>libsystem</code></li>
</ol>
<h4 id="instrument---systemtrace--timeprofiler">Instrument - SystemTrace / TimeProfiler</h4>
<p>ä¼šè®°å½•å¯åŠ¨çš„ä¸€äº›ä¿¡æ¯</p>
<h4 id="xcodeé…ç½®linkmapæ‹¿åˆ°linkmapæ–‡ä»¶åˆ†æ">Xcodeé…ç½®LinkMapï¼Œæ‹¿åˆ°LinkMapæ–‡ä»¶ï¼Œåˆ†æ</h4>
<p><img src="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693807063070.jpg"
	width="1024"
	height="419"
	srcset="/p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693807063070_hu282fae3aa909e21319b61c0a0351cbbf_48865_480x0_resize_q75_box.jpg 480w, /p/ios%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/16693807063070_hu282fae3aa909e21319b61c0a0351cbbf_48865_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="244"
		data-flex-basis="586px"
	
></p>
<h4 id="å…¶ä»–12ä¸æ¨èå¼€æ‹“æ€è·¯">å…¶ä»–ï¼ˆ1ï¼Œ2ä¸æ¨èï¼Œå¼€æ‹“æ€è·¯ï¼‰</h4>
<ol>
<li>å®šæ—¶æŠ“å–ä¸»çº¿ç¨‹ä¸Šçš„æ–¹æ³•è°ƒç”¨å †æ ˆï¼ˆbacktraceï¼‰ï¼Œè®¡ç®—ä¸€æ®µæ—¶é—´é‡Œå„ä¸ªæ–¹æ³•çš„è€—æ—¶ã€‚</li>
<li>hook objc_msgSend æ–¹æ³•è¿›è¡Œhookï¼ŒæŒæ¡æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ ï¼ˆlibffi, facebook fishhookï¼‰</li>
<li>åœ¨å¯åŠ¨çš„ç›¸å…³æ—¶æœºæ’å…¥è‡ªå®šä¹‰çš„åŠ¨æ€åº“ï¼Œé…åˆæŠ€æœ¯åŸ‹ç‚¹</li>
<li>Apple-Metricsï¼ˆå¯è‡ªå®šä¹‰ï¼‰ é…åˆåˆ†æçº¿ä¸Š</li>
</ol>
<h2 id="objcæºç ä¸‹è½½">objcæºç ä¸‹è½½</h2>
<h3 id="objc818">objc818</h3>
<p><a class="link" href="objc818-canrun.zip" >objc818-canrun</a></p>
<h3 id="objc838">objc838</h3>
<p><a class="link" href="objc838-canrun.zip" >objc838-canrun</a></p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">
        
        

        <div class="article-details">
            <h2 class="article-title">æ¶ˆæ¯å‘é€æºç å­¦ä¹ </h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E5%88%86%E6%9E%90-%E5%9C%A8oc%E4%B8%AD-self-class-%E4%B8%8E-super-class-%E7%9A%84%E5%8C%BA%E5%88%AB/">
        
        

        <div class="article-details">
            <h2 class="article-title">åˆ†æ åœ¨OCä¸­ [self class] ä¸ [super class] çš„åŒºåˆ«</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2018 - 
        
        2023 YoyoWong
    </section>
    
    <section class="powerby">
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
