[{"content":"objc æºç  objc818-canrun\nobjc838-canrun\n","date":"2022-02-18T00:00:00Z","permalink":"https://wangmingyou.github.io/p/open_source/","title":"æºç å­¦ä¹ "},{"content":"Macåˆ‡æ¢Pythonç‰ˆæœ¬ æ‰¾åˆ°å®‰è£…çš„macè·¯å¾„  ç³»ç»Ÿè‡ªå¸¦çš„ï¼š/System/Library/Frameworks/Python.framework è‡ªå·±å®‰è£…çš„python3: /usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework\n ä¿®æ”¹é…ç½®æ–‡ä»¶   æ‰¾åˆ°æ ¹ç›®å½•ä¸‹çš„***.zshrc*** æˆ–è€… .bash_profile   ä¿®æ”¹æ–‡ä»¶ å°†å¦‚ä¸‹å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶ä¸­,æ ¹æ®éœ€æ±‚è®¾ç½®é»˜è®¤pythonç‰ˆæœ¬\n  1 2 3  # python é…ç½® alias python=\u0026#39;/System/Library/Frameworks/Python.framework/Versions/2.7/bin/python2.7\u0026#39; # alias python=\u0026#39;/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/bin/python3.9\u0026#39;   ä¿å­˜æ–‡ä»¶ï¼Œåœ¨å‘½ä»¤è¡Œæ‰§è¡Œsource ~/.zshrc æˆ–è€… source ~/.bash_profileï¼Œæ˜¯ä¿®æ”¹çš„å†…å®¹ç”Ÿæ•ˆ\næŸ¥çœ‹ç”Ÿæ•ˆåçš„pythonç‰ˆæœ¬ åœ¨å‘½ä»¤è¡Œæ‰§è¡Œpython --versionï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ã€‚\n","date":"2022-01-15T00:00:00Z","permalink":"https://wangmingyou.github.io/p/mac-change-pyhton/","title":"Macåˆ‡æ¢Pythonç‰ˆæœ¬"},{"content":"å…¥å£ objc_msgSend æå‡ºç–‘é—® æ–¹æ³• -\u0026gt; æ¶ˆæ¯ï¼Œ å¦‚ä½•å‘é€çš„ï¼Ÿ\nsel-imp æ–¹æ³•ç¼–è¯‘ä¸ºå‡½æ•°é»˜è®¤æœ‰ä¸¤ä¸ªå‚æ•° ï¼ˆid selfï¼Œ SEL _cmdï¼‰\nself: æ¶ˆæ¯æ¥å—è€…\n_cmd: æ–¹æ³•ç¼–å·ï¼Œ æ‰¾åˆ°å…·ä½“å‡½æ•°å®ç°\nç›®å½• ï¼ˆSELï¼‰ï¼Œé¡µç ï¼ˆIMPï¼š æŒ‡å‘å‡½æ•°å…·ä½“å®ç°çš„æŒ‡é’ˆï¼‰ï¼Œå…·ä½“å†…å®¹ï¼ˆå‡½æ•°å®ç° ï¼‰\nå¦‚ä½•ä»SEL æ‰¾åˆ° IMP\næ±‡ç¼–ï¼Œæ–­ç‚¹æŸ¥çœ‹ libobjcæºç åˆ†æ è¿›å…¥æ±‡ç¼–æŸ¥æ‰¾è¿‡ç¨‹ objc-msg-arm64 ENTRY _objc_msgSend\nCacheLookup  CacheLookup, æœ‰ç¼“å­˜åˆ—è¡¨   CacheHitï¼Œæ‰¾åˆ°è¿”å›  ç›´æ¥ä»å¯„å­˜å™¨è·å–\nCheckMissï¼Œæ²¡æ‰¾åˆ°  æ­£å¸¸å°±æ˜¯ç”¨Normalè¿›æ¥çš„ï¼Œæ‰€ä»¥èµ°__objc_msgSend_uncached\nc. add æ·»åŠ è¿›å»ï¼Œæ–¹ä¾¿ä¸‹æ¬¡æ“ä½œ\nMethodTableLookup æˆ‘ä»¬éƒ½çŸ¥é“OCçš„å¯¹è±¡æœ€ç»ˆæ±‡ç¼–æˆç»“æ„ä½“ï¼Œç»“æ„ä½“æ˜¯Classï¼Œä¹Ÿå°±æ˜¯objc_class\nç”±æ­¤å¯ä»¥çœ‹åˆ°åœ¨ç»“æ„ä½“é‡Œé¢æœ‰ï¼š æ–¹æ³•åˆ—è¡¨ï¼Œå±æ€§åˆ—è¡¨ï¼Œåè®®åˆ—è¡¨\nruntime æ˜¯ç”± C, C++, æ±‡ç¼–æ··åˆæä¾›è¿è¡Œæ—¶åŠŸèƒ½ï¼Œ æ‰€ä»¥æœç´¢åˆ é™¤ä¸€ä¸ª\u0026quot;_\u0026quot;, æœç´¢\u0026quot;_class_lookupMethodAndLoadCache3\u0026quot;\nè¿›å…¥C/C++å‡½æ•°æ–¹æ³• æŸ¥æ‰¾è¿‡ç¨‹ æ­¤æ—¶å·²ç»ç¦»å¼€æ±‡ç¼–è¿‡ç¨‹ï¼ˆå¿«é€Ÿï¼‰ï¼Œä»lookUpImpOrForwardå¼€å§‹è¿›å…¥æ…¢é€ŸæŸ¥æ‰¾è¿‡ç¨‹\nclsï¼š Class ç±»å¯¹è±¡\nclsç±»å¯¹è±¡\nå®ä¾‹å¯¹è±¡\nå…ƒç±»å¯¹è±¡\nç»§æ‰¿å…³ç³»å®ç° å®é™…åº”ç”¨  NSObject åˆ†ç±»æ·»åŠ æ–¹æ³•ï¼Œé˜²æ­¢å´©æºƒ ç½‘ç»œè·å–æ•°æ®ï¼Œå¯èƒ½int/stringï¼Œint.lengthï¼Œä¸çŸ¥é“æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Œåº”è¯¥åŠ¨æ€æ·»åŠ  é‡åˆ°å´©æºƒï¼Œæç¤ºé€€å‡ºé¡µé¢ï¼Œä¸ŠæŠ¥crashï¼ŒåŠ¨æ€å¤„ç†  åŠ¨æ€æ–¹æ³•è§£æ TypeEcoding v@: id:self, cmd -\u0026gt; void\næ¶ˆæ¯è½¬å‘ aspectï¼Œæ¶ˆæ¯è½¬å‘çš„å…·ä½“åº”ç”¨\næºç è·‘åŠŸèƒ½   æ¶ˆæ¯å‘é€çš„æµç¨‹å›¾ æ€»ç»“  æ–¹æ³•çš„æœ¬è´¨æ˜¯å‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯çš„å‡ ä¸ªæµç¨‹    å¿«é€ŸæŸ¥æ‰¾ï¼ˆobjc_msgSendï¼‰~ cache_t ç¼“å­˜æ¶ˆæ¯ æ…¢é€ŸæŸ¥æ‰¾ï½ é€’å½’è‡ªå·±ï½œçˆ¶ç±»ï½ lookupImpOrForWard æŸ¥ä¸åˆ°æ¶ˆæ¯ï¼šåŠ¨æ€â½…æ³•è§£æ~ resolveInstanceMethod æ¶ˆæ¯å¿«é€Ÿè½¬å‘~ forwardingTargetForSelector æ¶ˆæ¯æ…¢é€Ÿè½¬å‘~ methodSignatureForSelector \u0026amp; forwardInvocation   sel æ˜¯æ–¹æ³•ç¼–å·ï¼Œåœ¨read_imagesæœŸé—´å°±ç¼–è¯‘è¿›å†…å­˜ impæ˜¯å‡½æ•°å®ç°çš„æŒ‡é’ˆï¼Œæ‰¾impå°±æ˜¯æ‰¾å‡½æ•°   sel å¯ä»¥ç†è§£ä¸ºä¹¦æœ¬çš„ç›®å½•æ ‡é¢˜ï¼Œimpå°±æ˜¯ä¹¦æœ¬çš„é¡µç ã€‚æŸ¥æ‰¾å…·ä½“çš„å‡½æ•°ï¼Œå°±æ˜¯çœ‹è¿™æœ¬ä¹¦é‡Œé¢å…·ä½“çš„å†…å®¹ï¼Œé€šè¿‡æƒ³çœ‹çš„æ ‡é¢˜æ‰¾åˆ°å¯¹åº”çš„é¡µéª‚æœ€åç¿»åˆ°å…·ä½“çš„å†…å®¹ï¼Œå³æ˜¯ sel - æŒ‡é’ˆ(imp) - å…·ä½“å®ç°\n ","date":"2020-01-15T00:00:00Z","permalink":"https://wangmingyou.github.io/p/objc_msgsend/","title":"æ¶ˆæ¯å‘é€æºç å­¦ä¹ "},{"content":"ç›´æ¥çœ‹ä¸€æ®µä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  @interface Person : NSObject @end @implementation Person @end @interface Worker : Person @end @implementation Worker - (instancetype)init{ self = [super init]; if (self) { NSLog(@\u0026#34;ğŸ¦ï¸ [self class] %@\u0026#34;,NSStringFromClass([self class])); NSLog(@\u0026#34;ğŸ¦ï¸ [super class] %@\u0026#34;,NSStringFromClass([super class])); } return self; } @end @implementation TestSuperClass // åˆ†æ [self class] ä¸ [super class] çš„åŒºåˆ« - (void) test { Worker *worker = [[Worker alloc] init]; } @end   æ‰“å°ç»“æœï¼š 1 2  2022-04-09 19:08:09.612737+0800 Object-CDemo[68945:1164926] ğŸ¦ï¸ [self class] Worker 2022-04-09 19:08:09.612854+0800 Object-CDemo[68945:1164926] ğŸ¦ï¸ [super class] Worker    ç›¸ä¿¡ä¸€ä¸ªæ‰“å°å¤§å®¶éƒ½å¾ˆå¥½ç†è§£ï¼Œç¬¬äºŒä¸ªå°±ä¸å¥½ç†è§£äº†ï¼Œé‚£ä¹ˆç°åœ¨ä¸»è¦æ¥åˆ†æä¸‹ super class\n  åœ¨objc æºç ä¸­ æ‰¾åˆ°class çš„æºç å®ç°\n 1 2 3 4 5 6 7  - (Class)class { /* 1. æ‰€æœ‰çš„å‡½æ•°ï¼Œéƒ½æœ‰ä¸¤ä¸ªé»˜è®¤çš„éšè—å‚æ•°ï¼š(id self , sel _cmd), è¿™é‡Œçš„ç”¨çš„selfå°±æ˜¯ç¬¬ä¸€ä¸ªéšè—å‚æ•°ï¼Œå°±æ˜¯æ¶ˆæ¯çš„æ¥å—ä½“ 2. ç°åœ¨çš„å…³é”®é—®é¢˜æ˜¯ï¼Œéšè—å‚æ•°self åˆ°åº•æ˜¯è°ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯çš„æ¥å—è€…æ˜¯è° */ return object_getClass(self); }    è¿™é‡Œæ˜¾è€Œæ˜“è§ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ª[self class]çš„selfæ˜¯workerå°±æ˜¾è€Œæ˜“è§äº†ã€‚é‚£ä¹ˆç¬¬äºŒä¸ªä¸ºä»€ä¹ˆä¹Ÿæ˜¯workerå‘¢ï¼Ÿ\n åˆ†æçš„å¸¸è§æ€è·¯ æ–¹æ³•1: clang çœ‹åˆ°åº•åº•å±‚ç¼–è¯‘æˆä»€ä¹ˆæ ·çš„æºç  æ–¹æ³•2: objcæºç  runèµ·æ¥ï¼Œç›´æ¥æ–­ç‚¹åˆ†æåˆ†æ æ–¹æ³•3: æ–­ç‚¹æ±‡ç¼– + æºç é…åˆ åˆ†æ æ–¹æ³•4: NSObject MethodSwizzling class æ–¹æ³•  å‰ä¸¤ç§æ–¹æ³•ï¼Œæˆ‘è§‰å¾—éƒ½æœ‰ç‚¹éº»çƒ¦ï¼Œæ–¹æ³•4ï¼ŒMethodSwizzlingä¹Ÿåªæ˜¯éªŒè¯æ‰“å°ç»“æœï¼Œå¯¹æˆ‘ä»¬åˆ†ææœ¬è´¨ï¼Œå¸®åŠ©å¯èƒ½ä¸å¤§ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥é€‰æ‹©æ–¹æ³•3ï¼Œå¿«æ·è¿˜å¯ä»¥åˆ†æåº•å±‚åŸå› ã€‚\n æ–­ç‚¹æ±‡ç¼–åˆ†æ é¦–å…ˆé€‰æ‹©æ–­ç‚¹çš„æ±‡ç¼–æ¨¡å¼      è¿™é‡Œæ˜¾è€Œæ˜“è§ [super class] æœ€ç»ˆèµ°çš„æ˜¯objc_msgSendSuper2æ¶ˆæ¯å‘é€ï¼Œå†ç»“åˆæºç ã€‚\n 1 2 3  objc_msgSendSuper2(struct objc_super * _Nonnull super, SEL _Nonnull op, ...) #endif   // é€šè¿‡objcæºç é‡Œé¢ç®€åŒ– objc_super\n1 2 3 4 5  struct objc_super { __unsafe_unretained _Nonnull id receiver; //æ¶ˆæ¯æ¥æ”¶è€… __unsafe_unretained _Nonnull Class super_class; };    ä¹Ÿå°±æ˜¯NSLog(@\u0026quot;ğŸ¦ï¸ [super class] %@\u0026quot;,NSStringFromClass([super class])) ç­‰åŒäºä¸‹é¢çš„ä¸€æ®µä»£ç \n 1 2 3 4 5 6  // [super class] ç­‰åŒäºä¸‹é¢ä¸€æ®µä»£ç  struct objc_super test_super = { self, // ç ”ç©¶å¯¹è±¡æ˜¯åœ¨workeré‡Œé¢ class_getSuperclass([self class]), }; NSLog(@\u0026#34;%@\u0026#34;,NSStringFromClass(objc_msgSendSuper2(\u0026amp;test_super,@selector(class))));    è½¬åŒ–åå¾ˆå¥½ç†è§£äº†ï¼Œå…¶å®å°±æ˜¯ç»™selfï¼ˆworkerï¼‰å‘é€æ¶ˆæ¯ï¼Œè°ƒç”¨classæ–¹æ³•ã€‚è¿™æ ·å°±èƒ½ç†è§£æ‰“å°ç»“æœäº†ã€‚\n é‚£ä¹ˆ [super class] ä¸ [self class] æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢  è™½ç„¶ç°åœ¨ç†è§£äº†ä¸¤è€…ç»“æœä¸€æ ·ï¼Œé‚£ä¹ˆ[super class] æœ‰ä»€ä¹ˆç‰¹æ®Šçš„å‘¢ï¼Ÿä¹Ÿå°±æ˜¯objc_super é‡Œé¢çš„ class_getSuperclass([self class]), å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å…¶å®æœ¬è´¨åŒºåˆ«å°±æ˜¯objc_msgSendSuper ä¸objc_msgSend æœ‰ä»€ä¹ˆåŒºåˆ«?\n objc_msgSend æµç¨‹ objc_msgSendå…·ä½“æµç¨‹ å¯ä»¥çœ‹åˆ°è¿™ä¸ªobjc_msgSendæ…¢é€Ÿæµç¨‹å›å»éå†çˆ¶ç±»ï¼Œæ¯”è¾ƒæ…¢ï¼Œobjc_msgSendSuperå°±å¯ä»¥è·³è¿‡å¾ˆå¤šéå†ï¼Œå˜å¾—æ›´å¿«äº†ã€‚\nç»“è®º  [self class] å°±æ˜¯å‘é€æ¶ˆæ¯objc_msgSendï¼Œæ¶ˆæ¯æ¥å—è€…æ˜¯ self â½…æ³•ç¼–å·ï¼šclass [super class] æœ¬è´¨å°±æ˜¯objc_msgSendSuper, æ¶ˆæ¯çš„æ¥å—è€…è¿˜æ˜¯ self â½…æ³•ç¼–å·ï¼šclass é€»è¾‘æ•™è‚² åªæ˜¯objc_msgSendSuper ä¼šæ›´å¿« ç›´æ¥è·³è¿‡ self çš„æŸ¥æ‰¾\n ","date":"2019-03-15T00:00:00Z","permalink":"https://wangmingyou.github.io/p/super-class-study/","title":"åˆ†æ åœ¨OCä¸­ [self class] ä¸ [super class] çš„åŒºåˆ«"}]